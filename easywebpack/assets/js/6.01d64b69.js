(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{149:function(a,s,t){"use strict";t.r(s);var e=t(0),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"easywebpack-cli-构建大小分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#easywebpack-cli-构建大小分析"}},[a._v("#")]),a._v(" easywebpack-cli 构建大小分析")]),a._v(" "),t("p",[a._v("在项目开发时， 当页面构建的文件太大, 我们可以直接通过 cli 提供功能进行构建大小分析")]),a._v(" "),t("h4",{attrs:{id:"通过-s-参数启动构建大小分析工具-支持-analyzer-webpack-bundle-analyzer-和-stats-stats-webpack-plugin-默认用-analyzer-插件。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过-s-参数启动构建大小分析工具-支持-analyzer-webpack-bundle-analyzer-和-stats-stats-webpack-plugin-默认用-analyzer-插件。"}},[a._v("#")]),a._v(" 通过 -s 参数启动构建大小分析工具, 支持 analyzer(webpack-bundle-analyzer) 和 stats(stats-webpack-plugin) , 默认用 analyzer 插件。")]),a._v(" "),t("blockquote",[t("p",[a._v("如果运行时, 提示安装缺少插件，请先安装依赖")])]),t("ul",[t("li",[t("p",[a._v("开发模式分析")])])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("easy build -s \n")])])]),t("ul",[t("li",[t("p",[a._v("测试模式分析, 移除开发辅助代码")])])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("easy build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" -s \n")])])]),t("ul",[t("li",[t("p",[a._v("发布模式分析, 移除开发辅助代码, 压缩js/css/imagess以及hash")])])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("easy build prod -s \n")])])]),t("p",[t("img",{staticStyle:{"max-width":"600px",width:"827px"},attrs:{src:"https://cdn.yuque.com/yuque/0/2018/png/116733/1528513212579-add62c3b-de8e-49bd-b4dc-7ebb8f126d3a.png#width=827"}})]),a._v(" "),t("h4",{attrs:{id:"使用-stats-stats-webpack-plugin-构建大小分析工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-stats-stats-webpack-plugin-构建大小分析工具"}},[a._v("#")]),a._v(" 使用 stats(stats-webpack-plugin) 构建大小分析工具")]),a._v(" "),t("blockquote",[t("p",[a._v("如果运行时, 提示安装缺少插件，请先安装依赖")])]),t("ul",[t("li",[t("p",[a._v("开发模式分析")])])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("easy build -s stats \n")])])]),t("ul",[t("li",[t("p",[a._v("测试模式分析, 移除开发辅助代码")])])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("easy build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v(" -s stats \n")])])]),t("ul",[t("li",[t("p",[a._v("发布模式分析, 移除开发辅助代码, 压缩js/css/imagess以及hash")])])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("easy build prod -s stats \n")])])]),t("p",[t("strong",[a._v("运行后, 会生成  ")]),t("strong",[t("code",[a._v("client_stats.json")])]),t("strong",[a._v(" 文件,  然后通过以下两个工具可以清晰分析出项目文件层次结构和项目文件依赖大小")])]),t("ul",[t("li",[t("p",[a._v("打开 "),t("a",{attrs:{href:"http://alexkuz.github.io/webpack-chart/",target:"_blank"}},[a._v("webpack-chart")]),a._v(" 然后上传 stat.json 文件，即可生成整体的项目文件层次结构图。"),t("br"),a._v("点击任何一个区域，进入子目录文件分析，这个工具只能提供一个整体的文件依赖结构。")])])]),t("p",[t("img",{staticStyle:{"max-width":"600px",width:"650px"},attrs:{src:"https://cdn.yuque.com/yuque/0/2018/png/116733/1528513227023-9b1f1ab6-f434-415b-9bbb-7d823094d8bd.png#width=650"}})]),t("ul",[t("li",[t("p",[a._v("打开 "),t("a",{attrs:{href:"http://webpack.github.io/analyse/",target:"_blank"}},[a._v("analyse")]),a._v(" 然后上传stat.json文件，即可生成整个项目文件个数(包括vue文件，js，css， image， chunk等)，文件大小，文件依赖关系统计，可以很方便找出筛选出大的js，image， css，然后进行针对性的优化，信息很全，对优化文件大小有很大帮助，唯一不方便的是统计结果不能排序")])])]),t("p",[t("img",{staticStyle:{"max-width":"600px",width:"800px"},attrs:{src:"https://cdn.yuque.com/yuque/0/2018/png/116733/1528513236394-625fa458-aeae-41d9-a7d9-cdc8d41197ba.png#width=800"}})]),a._v(" "),t("h2",{attrs:{id:"构建大小优化措施"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建大小优化措施"}},[a._v("#")]),a._v(" 构建大小优化措施")]),a._v(" "),t("h3",{attrs:{id:"_1-1-webpack构建node端设置externals"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-webpack构建node端设置externals"}},[a._v("#")]),a._v(" 1.1 Webpack构建Node端设置externals")]),a._v(" "),t("p",[a._v("防止将某些 import 的包(package)打包到 bundle 中，而是在运行时(runtime)通过require方式获取依赖。")]),a._v(" "),t("h3",{attrs:{id:"_1-2-lodash-按需打包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-lodash-按需打包"}},[a._v("#")]),a._v(" 1.2 lodash 按需打包")]),a._v(" "),t("p",[a._v("根据需要独立安装"),t("code",[a._v("lodash")]),a._v("相关依赖， 目前lodash各个方法都有独立的npm库")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),a._v(" merge "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'lodash.merge'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// or ES6")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" merge "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'lodash.merge'")]),a._v(" \n")])])]),t("h3",{attrs:{id:"_1-3-webpack常量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-webpack常量"}},[a._v("#")]),a._v(" 1.3 Webpack常量")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("用"),t("code",[a._v("webpack.DefinePlugin")]),a._v(" 插件注入常量替换 typeof window 判断， 这样Webpack打包压缩时会自动移除不会执行的代码。")])])]),t("ul",[t("li",[t("p",[a._v("Vue框架或者第三方框架，有很多地方通过 "),t("code",[a._v("process.env.NODE_ENV")]),a._v(" 加入一些调试或者监控代码，在线上发布模式时，是不需要的， 用"),t("code",[a._v("webpack.DefinePlugin")]),a._v(" 插件注入"),t("code",[a._v("NODE_ENV=production")]),a._v("可以减少打包大小和执行效率。")])])]),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://www.yuque.com/hubcarl/easywebpack/var",target:"_blank"}},[a._v("easywebpack 内置常量")])])])]),a._v(" "),t("h3",{attrs:{id:"_1-4-commonchunkplugin-抽离公共代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-commonchunkplugin-抽离公共代码"}},[a._v("#")]),a._v(" 1.4 CommonChunkPlugin 抽离公共代码")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("在多页面构建中， 一些公共代码可以通过"),t("code",[a._v("webpack.optimize.CommonsChunkPlugin")]),a._v(" 抽离公共代码库，比如 "),t("code",[a._v("vue")]),a._v(","),t("code",[a._v("axios")]),a._v(" 等")])])]),a._v(" "),t("h3",{attrs:{id:"_1-5-code-spliting代码分离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-code-spliting代码分离"}},[a._v("#")]),a._v(" 1.5 Code Spliting代码分离")]),a._v(" "),t("p",[a._v("Webpack打包是把所有js代码打成一个js文件，我们可以通过 "),t("code",[a._v("CommonsChunkPlugin")]),a._v(" 分离出公共组件，但这远远不够。 实际业务开发时，一些主要页面内容往往比较多， 而且会引入第三方组件或者监控脚本。其中有些内容的展示不再首屏或者监控脚本等对用户不是那么重要的脚本我们可以通过"),t("code",[a._v("require.ensure")]),a._v("代码分离延迟加载。在 Webpack 在构建时，解析到"),t("code",[a._v("require.ensure")]),a._v("时，会单独针对引入的js资源单独构建出chunk文件，这样就能从主js文件里面分离出来。 然后页面加载完后， 通过script标签的方式动态插入到文档中。")]),t("p",[a._v("require.ensure 使用方式， 第三个参数是指定生产的chunk文件名，不设置时是用数字编号代理。相同require.ensure只会生产一个chunk文件。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("require"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ensure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'swiper'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" Swiper "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'swiper'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'swiper'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n")])])]),t("p",[a._v("游戏中心项目swpier，fastclick, sentry，曝光率组件，各大APP的JSSDK加载都采用require.ensure动态加载或者按需加载。"),t("br"),t("img",{staticStyle:{"max-width":"600px"},attrs:{src:"https://private-alipayobjects.alipay.com/alipay-rmsdeploy-image/skylark/png/2ce263b58700273f.png#width="}}),t("br"),a._v("另外一种动态加载Vue组件import()方案已经列入"),t("a",{attrs:{href:"https://github.com/tc39/proposal-dynamic-import",target:"_blank"}},[a._v("ECMAScript提案")]),a._v("，虽然在提案阶段，但 Webpack 已经支持了该特性。import() 返回的Promise，通过注释webpackChunkName 指定生成的chunk名称。 Webpack构建时会独立的chunkjs文件，然后在客户端动态插入组件，chunk机制与require.ensure一样。有了动态加载的方案，可以减少服务端渲染jsbundle文件的大小，页面Vue组件模块也可以按需加载。 比如单页面动态路由加载。")]),a._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[a._v("Vue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("component")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'async-swiper'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[a._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 通过注释webpackChunkName 指定生成的chunk名称")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('/* webpackChunkName: "asyncSwiper" */')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'./AsyncSwiper.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[a._v("AsyncSwiper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n     "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("AsyncSwiper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("div id"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"app"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("Vue dynamic component load"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("async"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("swiper"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("async"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("swiper"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("div"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" \n")])])]),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://github.com/hubcarl/egg-vue-webpack-boilerplate/blob/master/app/web/page/dynamic/dynamic.vue",target:"_blank"}},[a._v("具体服务端渲染例子")])])])]),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/36233639",target:"_blank"}},[a._v("https://zhuanlan.zhihu.com/p/36233639")])])])]),a._v(" "),t("h3",{attrs:{id:"_1-6-tree-shaking"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-tree-shaking"}},[a._v("#")]),a._v(" 1.6 Tree Shaking")]),a._v(" "),t("p",[a._v("Tree Shaking 冗余代码移除技术还不完善，必须按照 ES Module 的方式编写代码，但这与我们项目复杂，js代码量大，全部使用method方式不利于代码维护和扩展，我们采用面向对象的组织代码的方式有出入。Tree Shaking 目前来说比较适合一些简单类库，当然 Webpack 社区也在不断的完善.")]),a._v(" "),t("h3",{attrs:{id:"_1-7-最小原则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-最小原则"}},[a._v("#")]),a._v(" 1.7 最小原则")]),a._v(" "),t("p",[a._v("项目开发时，尽量不要引入一些第三方库，能不用尽量不用，如果要引入，要考虑包大小以及是否可以动态加载。因为当页面多，功能复杂后，JS文件会越来越大。")])])}),[],!1,null,null,null);s.default=n.exports}}]);