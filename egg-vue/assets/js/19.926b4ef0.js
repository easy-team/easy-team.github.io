(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{159:function(s,e,t){"use strict";t.r(e);var a=t(0),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"egg-vue-react-ssr-使用-service-worker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#egg-vue-react-ssr-使用-service-worker"}},[s._v("#")]),s._v(" Egg + Vue/React SSR 使用 service worker")]),s._v(" "),t("p",[t("code",[s._v("easywebpack")]),s._v(" 默认生成的 "),t("code",[s._v("service-worker.js")]),s._v(" 是在 "),t("code",[s._v("${app_root}/public/service-worker.js")]),s._v("这里. 这样 "),t("code",[s._v("service-worker.js")]),s._v(" 访问路径是 "),t("a",{attrs:{href:"http://127.0.0.1:7001/public/service-worker.js%E3%80%82",target:"_blank"}},[s._v("http://127.0.0.1:7001/public/service-worker.js。")])]),t("p",[s._v("将 service worker 文件注册为 "),t("code",[s._v("/public/service-worker.js")]),s._v("，那么，service worker 只能收到 /public/ 路径下的 "),t("code",[s._v("fetch")]),s._v(" 事件（例如： /public/page1/, /public/page2/), 但我们的页面访问是没有 /public/ 这一层路径的。正常情况下, "),t("code",[s._v("service-worker.js")]),s._v(" 文件被放在这个域的根目录下，和网站同源。这个 service worker 将会收到这个域下的所有 fetch 事件。")]),t("p",[s._v("这个问题可以通过 "),t("a",{attrs:{href:"https://github.com/hubcarl/egg-serviceworker",target:"_blank"}},[s._v("egg-serviceworker")]),s._v(" 解决。通过 "),t("code",[s._v("egg-serviceworker")]),s._v(" 插件, 我们可以这样访问 "),t("a",{attrs:{href:"http://127.0.0.1:7001/service-worker.js",target:"_blank"}},[s._v("http://127.0.0.1:7001/service-worker.js")])]),t("ul",[t("li",[t("p",[s._v("启用 "),t("code",[s._v("egg-serviceworker")])])])]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ${app_root}/config/plugin.js")]),s._v("\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("serviceworker "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n enable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'egg-serviceworker'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])])]),t("ul",[t("li",[t("p",[s._v("注册 "),t("code",[s._v("service worker")])])])]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" serviceWorkerRegister "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'service-worker-register'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// The service-worker.js name will get really url address by sw-mapping.json file")]),s._v("\nserviceWorkerRegister"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'service-worker.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])])]),t("ul",[t("li",[t("p",[s._v("自动打开 localhost 域名地址")])])]),t("p",[s._v("配置本地开发启动自动打开 localhost 域名地址")]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ${app_root}/config/config.local.js")]),s._v("\nexports"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("webpack "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n browser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:7001'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])])]),t("ul",[t("li",[t("p",[s._v("本地测试")])])]),t("blockquote",[t("p",[s._v("注意：因开发环境构建的文件在内存中，sw-precache 获取不到文件列表，目前开发环境是不会注册的。可以通过 发布模式 在本地查看 "),t("code",[s._v("service worker")]),s._v(" 注册情况。")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build:test\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run start:test \n")])])]),t("p",[s._v("或")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run start \n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);