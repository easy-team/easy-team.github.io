<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>背景 | Egg + Vue 工程化解决方案</title>
    <meta name="description" content="Egg + Vue 服务端和前端渲染工程方案">
    
    
    <link rel="preload" href="/egg-vue/assets/css/0.styles.79987df1.css" as="style"><link rel="preload" href="/egg-vue/assets/js/app.1ad586ba.js" as="script"><link rel="preload" href="/egg-vue/assets/js/2.67c62971.js" as="script"><link rel="preload" href="/egg-vue/assets/js/8.b57e23ca.js" as="script"><link rel="prefetch" href="/egg-vue/assets/js/10.5913bca5.js"><link rel="prefetch" href="/egg-vue/assets/js/11.61e8966f.js"><link rel="prefetch" href="/egg-vue/assets/js/12.03115eb8.js"><link rel="prefetch" href="/egg-vue/assets/js/13.b3b0b2e5.js"><link rel="prefetch" href="/egg-vue/assets/js/14.c3af845f.js"><link rel="prefetch" href="/egg-vue/assets/js/15.c4d16641.js"><link rel="prefetch" href="/egg-vue/assets/js/16.d5ea3b1b.js"><link rel="prefetch" href="/egg-vue/assets/js/17.d3aa1c4c.js"><link rel="prefetch" href="/egg-vue/assets/js/18.859ef396.js"><link rel="prefetch" href="/egg-vue/assets/js/19.9124f1fa.js"><link rel="prefetch" href="/egg-vue/assets/js/20.9542dbde.js"><link rel="prefetch" href="/egg-vue/assets/js/21.6a7ed926.js"><link rel="prefetch" href="/egg-vue/assets/js/22.6dd0d737.js"><link rel="prefetch" href="/egg-vue/assets/js/23.a53e99f9.js"><link rel="prefetch" href="/egg-vue/assets/js/24.78389b2f.js"><link rel="prefetch" href="/egg-vue/assets/js/25.45266e9e.js"><link rel="prefetch" href="/egg-vue/assets/js/3.8ff6cff4.js"><link rel="prefetch" href="/egg-vue/assets/js/4.e73e36c5.js"><link rel="prefetch" href="/egg-vue/assets/js/5.79e85244.js"><link rel="prefetch" href="/egg-vue/assets/js/6.70ec450c.js"><link rel="prefetch" href="/egg-vue/assets/js/7.5134000b.js"><link rel="prefetch" href="/egg-vue/assets/js/9.74b06747.js">
    <link rel="stylesheet" href="/egg-vue/assets/css/0.styles.79987df1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/egg-vue/" class="home-link router-link-active"><!----> <span class="site-name">Egg + Vue 工程化解决方案</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/egg-vue/easywebpack.html" class="nav-link">easywebpack</a></div><div class="nav-item"><a href="/egg-vue/egg-vue.html" class="nav-link">egg + vue</a></div><div class="nav-item"><a href="/egg-vue/egg-react.html" class="nav-link">egg + react</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/egg-vue/easywebpack.html" class="nav-link">easywebpack</a></div><div class="nav-item"><a href="/egg-vue/egg-vue.html" class="nav-link">egg + vue</a></div><div class="nav-item"><a href="/egg-vue/egg-react.html" class="nav-link">egg + react</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/egg-vue/case.html" class="sidebar-link">项目一览</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>新手指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/egg-vue/init.html" class="sidebar-link">快速开始</a></li><li><a href="/egg-vue/start.html" class="sidebar-link">从零开始</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/egg-vue/render.html" class="sidebar-heading clickable open"><span>渲染模式</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/egg-vue/node.html" class="sidebar-link">服务端渲染模式</a></li><li><a href="/egg-vue/web.html" class="sidebar-link">前端渲染模式</a></li><li><a href="/egg-vue/asset.html" class="active sidebar-link">asset 渲染模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/egg-vue/asset.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/egg-vue/asset.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/egg-vue/asset.html#骨架项目" class="sidebar-link">骨架项目</a></li><li class="sidebar-sub-header"><a href="/egg-vue/asset.html#参考实现" class="sidebar-link">参考实现</a></li></ul></li></ul></section></li><li><a href="/egg-vue/qpeiow.html" class="sidebar-link">入口实现</a></li><li><a href="/egg-vue/build.html" class="sidebar-link">构建流程</a></li><li><a href="/egg-vue/online.html" class="sidebar-link">部署流程</a></li><li><a href="/egg-vue/version.html" class="sidebar-link">插件使用</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>特性介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/egg-vue/seo.html" class="sidebar-link">SEO实现</a></li><li><a href="/egg-vue/async.html" class="sidebar-link">异步加载</a></li><li><a href="/egg-vue/typescript.html" class="sidebar-link">TypeScript</a></li><li><a href="/egg-vue/pwa.html" class="sidebar-link">Service Worker</a></li><li><a href="/egg-vue/i18n.html" class="sidebar-link">i18n 国际化支持</a></li><li><a href="/egg-vue/babel.html" class="sidebar-link">Babel 构建优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/egg-vue/about.html" class="sidebar-heading clickable"><span>相关问题</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/egg-vue/open.html" class="sidebar-link">社区作品</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h2 id="背景"><a href="#背景" aria-hidden="true" class="header-anchor">#</a> 背景</h2> <p style="padding-left:2em;">在 <a href="https://www.yuque.com/easy-team/egg-vue/web" target="_blank">前端渲染模式</a> 章节讲到了基于 Vue 的一体化的前端渲染模式，好处是不需要借助第三方模板引擎且无效关注静态资源注入问题，但有两个小的功能限制：</p><ul><li><p>layout 模板数据绑定能力较弱</p></li></ul><ul><li><p>资源注入不能自己定义，比如 async， crossorigin 等配置</p></li></ul><p style="padding-left:2em;">针对上面问题<a href="https://github.com/easy-team/egg-view-vue-ssr" target="_blank"> egg-view-vue-ssr </a>(&gt;=3.2.0)扩展 <a href="https://github.com/easy-team/egg-view-vue-ssr/blob/master/app/extend/context.js#L8" target="_blank">renderAsset</a> 方法支持基于 asset 的<strong>前端渲染模式</strong>，方便对 layout 进行定制和数据绑定。</p><p style="padding-left:2em;"><br></p> <h2 id="使用"><a href="#使用" aria-hidden="true" class="header-anchor">#</a> 使用</h2> <ul><li><p>renderAsset 模式默认使用 <span style="color:#2F54EB;">egg-view-nunjucks</span> 模板引擎对 layout 进行数据模板编译，你需要在项目 package.json 中同时安装 <a href="https://github.com/easy-team/egg-view-vue-ssr" target="_blank">egg-view-vue-ssr</a> 和 <a href="https://github.com/eggjs/egg-view-nunjucks" target="_blank">egg-view-nunjucks</a> 插件依赖。</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ${root}/package.json</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;dependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;egg-view-nunjucks&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;egg-view-vue-ssr&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^3.2.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><ul><li><p>开启 <a href="https://github.com/eggjs/egg-view-nunjucks" target="_blank">egg-view-nunjucks</a> 插件配置</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ${root}/config/plugin.json</span>
exports<span class="token punctuation">.</span>vuessr <span class="token operator">=</span> <span class="token punctuation">{</span>
 enable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
 <span class="token keyword">package</span><span class="token punctuation">:</span> <span class="token string">'egg-view-vue-ssr'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>nunjucks <span class="token operator">=</span> <span class="token punctuation">{</span>
 enable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
 <span class="token keyword">package</span><span class="token punctuation">:</span> <span class="token string">'egg-view-nunjucks'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div><ul><li><p>配置 layout.html  模板</p></li></ul><blockquote><p>模板默认路径：${root}/app/view/layout.html<span style="color:#24292E;"><span style="background-color:#FFFFFF;">， 你可以通过</span></span><a href="https://github.com/easy-team/egg-view-vue-ssr" target="_blank"> egg-view-vue-ssr</a> 的 layout 属性配置指定模板位置。</p></blockquote><p><strong>渲染上下文暴露全局 asset 对象，参数如下：</strong></p><p style="padding-left:2em;"><strong>asset.js</strong> { Array } 页面依赖的静态 JS 资源 URL 列表， 来自 <code>config/manifest.json</code> 具体见 <a href="https://www.yuque.com/easy-team/easywebpack/deps" target="_blank">资源依赖</a></p><p style="padding-left:2em;"><strong>asset.css</strong> { Array } 页面依赖的静态 JS 资源 URL 列表，来自<code>config/manifest.json</code>具体见 <a href="https://www.yuque.com/easy-team/easywebpack/deps" target="_blank">资源依赖</a></p><p style="padding-left:2em;"><strong>asset.state</strong> { Object } 页面渲染原始数据，用于 MV 框架初始化 state</p><p>以下就是基于 nunjucks 的语法的 layout 模板配置, 你可以根据指定渲染引擎编写 layout 文件。</p> <div class="language-html extra-class"><pre class="language-html"><code>


 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>keywords<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>description<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content-type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/html;charset=utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>shortcut icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/favicon.ico<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/x-icon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 {% for item in asset.css %}
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 {% endfor %}


 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
   window<span class="token punctuation">.</span>__INITIAL_STATE__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> asset<span class="token punctuation">.</span>state <span class="token operator">|</span> safe <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 {% for item in asset.js %}
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 {% endfor %}


</code></pre></div><ul><li><p>renderAsset  默认调用，使用 nunjucks 模板引擎</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> egg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">AdminController</span> <span class="token keyword">extends</span> <span class="token class-name">egg<span class="token punctuation">.</span>Controller</span> <span class="token punctuation">{</span>
 <span class="token keyword">async</span> <span class="token function">home</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderAsset</span><span class="token punctuation">(</span><span class="token string">'admin.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'egg-vue-asset'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><ul><li><p>renderAsset 自定义模板引擎（支持两种方式, 注意要安装指定模板引擎)</p></li></ul><blockquote><ol start="1"><li><p> 可以通过 <a href="https://github.com/easy-team/egg-view-vue-ssr" target="_blank">egg-view-vue-ssr</a> 的 viewEngine  配置全局渲染引擎</p></li></ol><ol start="2"><li><p> 通过 renderAsset 的第三个参数 viewEngine 配置对应渲染引擎，只在当前渲染生效</p></li></ol><p></p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> egg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">AdminController</span> <span class="token keyword">extends</span> <span class="token class-name">egg<span class="token punctuation">.</span>Controller</span> <span class="token punctuation">{</span>
 <span class="token keyword">async</span> <span class="token function">home</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 使用 ejs 引擎，注意项目请安装 https://github.com/eggjs/egg-view-ejs 依赖</span>
   <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderAsset</span><span class="token punctuation">(</span><span class="token string">'admin.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'egg-vue-asset'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> viewEngine<span class="token punctuation">:</span> <span class="token string">'ejs'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><h2 id="骨架项目"><a href="#骨架项目" aria-hidden="true" class="header-anchor">#</a> 骨架项目</h2> <p style="padding-left:2em;"><a href="https://github.com/easy-team/egg-vue-webpack-boilerplate/tree/feature/green/asset" target="_blank">https://github.com/easy-team/egg-vue-webpack-boilerplate/tree/feature/green/asset</a></p> <h2 id="参考实现"><a href="#参考实现" aria-hidden="true" class="header-anchor">#</a> 参考实现</h2> <p style="padding-left:2em;"><a href="https://github.com/eggjs/egg-view-assets" target="_blank">https://github.com/eggjs/egg-view-assets</a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/egg-vue/web.html" class="prev">
          前端渲染模式
        </a></span> <span class="next"><a href="/egg-vue/qpeiow.html">
          入口实现
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/egg-vue/assets/js/app.1ad586ba.js" defer></script><script src="/egg-vue/assets/js/2.67c62971.js" defer></script><script src="/egg-vue/assets/js/8.b57e23ca.js" defer></script>
  </body>
</html>
