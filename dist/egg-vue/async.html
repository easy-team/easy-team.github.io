<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Component Async Load Render / 组件异步加载渲染 | Egg + Vue 工程化解决方案</title>
    <meta name="description" content="Egg + Vue 工程化解决方案, 支持 Egg + Vue 服务端渲染(Server Side Render) 和 前端渲染模式. GitHub: https://github.com/easy-team/egg-vue-webpack-boilerplate">
    
    
    <link rel="preload" href="/assets/css/0.styles.6f683ea6.css" as="style"><link rel="preload" href="/assets/js/app.ad616d9c.js" as="script"><link rel="preload" href="/assets/js/2.67c62971.js" as="script"><link rel="preload" href="/assets/js/14.c3af845f.js" as="script"><link rel="prefetch" href="/assets/js/10.5913bca5.js"><link rel="prefetch" href="/assets/js/11.61e8966f.js"><link rel="prefetch" href="/assets/js/12.03115eb8.js"><link rel="prefetch" href="/assets/js/13.b3b0b2e5.js"><link rel="prefetch" href="/assets/js/15.c4d16641.js"><link rel="prefetch" href="/assets/js/16.d5ea3b1b.js"><link rel="prefetch" href="/assets/js/17.d3aa1c4c.js"><link rel="prefetch" href="/assets/js/18.859ef396.js"><link rel="prefetch" href="/assets/js/19.9124f1fa.js"><link rel="prefetch" href="/assets/js/20.9542dbde.js"><link rel="prefetch" href="/assets/js/21.6a7ed926.js"><link rel="prefetch" href="/assets/js/22.6dd0d737.js"><link rel="prefetch" href="/assets/js/23.a53e99f9.js"><link rel="prefetch" href="/assets/js/24.78389b2f.js"><link rel="prefetch" href="/assets/js/25.45266e9e.js"><link rel="prefetch" href="/assets/js/3.8ff6cff4.js"><link rel="prefetch" href="/assets/js/4.e73e36c5.js"><link rel="prefetch" href="/assets/js/5.ce1114e6.js"><link rel="prefetch" href="/assets/js/6.70ec450c.js"><link rel="prefetch" href="/assets/js/7.5134000b.js"><link rel="prefetch" href="/assets/js/8.b57e23ca.js"><link rel="prefetch" href="/assets/js/9.74b06747.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6f683ea6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Egg + Vue 工程化解决方案</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/case.html" class="sidebar-link">项目一览</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>新手指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/init.html" class="sidebar-link">快速开始</a></li><li><a href="/start.html" class="sidebar-link">从零开始</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/render.html" class="sidebar-heading clickable"><span>渲染模式</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/node.html" class="sidebar-link">服务端渲染模式</a></li><li><a href="/web.html" class="sidebar-link">前端渲染模式</a></li><li><a href="/asset.html" class="sidebar-link">asset 渲染模式</a></li></ul></section></li><li><a href="/qpeiow.html" class="sidebar-link">入口实现</a></li><li><a href="/build.html" class="sidebar-link">构建流程</a></li><li><a href="/online.html" class="sidebar-link">部署流程</a></li><li><a href="/version.html" class="sidebar-link">插件使用</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>特性介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/seo.html" class="sidebar-link">SEO实现</a></li><li><a href="/async.html" class="active sidebar-link">异步加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/async.html#component-async-load-render-组件异步加载渲染" class="sidebar-link">Component Async Load Render / 组件异步加载渲染</a></li></ul></li><li><a href="/typescript.html" class="sidebar-link">TypeScript</a></li><li><a href="/pwa.html" class="sidebar-link">Service Worker</a></li><li><a href="/i18n.html" class="sidebar-link">i18n 国际化支持</a></li><li><a href="/babel.html" class="sidebar-link">Babel 构建优化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/about.html" class="sidebar-heading clickable"><span>相关问题</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/open.html" class="sidebar-link">社区作品</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h2 id="component-async-load-render-组件异步加载渲染"><a href="#component-async-load-render-组件异步加载渲染" aria-hidden="true" class="header-anchor">#</a> Component Async Load Render / 组件异步加载渲染</h2> <h3 id="_1-javascript-file-code-spliting-代码分离"><a href="#_1-javascript-file-code-spliting-代码分离" aria-hidden="true" class="header-anchor">#</a> 1. JavaScript File Code Spliting 代码分离</h3> <p style="padding-left:2em;">Webpack打包是把所有js代码打成一个js文件，我们可以通过 <code>CommonsChunkPlugin</code> 分离出公共组件，但这远远不够。 实际业务开发时，一些主要页面内容往往比较多， 而且会引入第三方组件或者监控脚本。其中有些内容的展示不再首屏或者监控脚本等对用户不是那么重要的脚本我们可以通过 <code>require.ensure</code> 代码分离延迟加载。在webpack在构建时，解析到<code>require.ensure</code> 时，会单独针对引入的js资源单独构建出chunk文件，这样就能从主js文件里面分离出来。 然后页面加载完后， 通过script标签的方式动态插入到文档中。</p><p>require.ensure 使用方式， 第三个参数是指定生产的 chunk 文件名，不设置时是用数字编号代理。相同 require.ensure 只会生产一个chunk文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>require<span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'swiper'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> Swiper <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'swiper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'swiper'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><h3 id="_2-vue-component-code-spliting-代码分离"><a href="#_2-vue-component-code-spliting-代码分离" aria-hidden="true" class="header-anchor">#</a> 2. Vue Component Code Spliting 代码分离</h3> <p style="padding-left:2em;">异步加载 Vue 组件(.vue) 已在 Vue 2.5+ 版本支持，包括路由异步加载和非路由异步加载。在具体实现时，我们可以通过 <code>import(filepath)</code> 加载组件。</p><p><code>import()</code> 方案已经列入 <a href="https://github.com/tc39/proposal-dynamic-import" target="_blank">ECMAScript提案</a>，虽然在提案阶段，但 Webpack 已经支持了该特性。import() 返回的 Promise，通过注释 webpackChunkName 指定生成的 chunk 名称。 Webpack 构建时会独立的 chunkjs 文件，然后在客户端动态插入组件，chunk 机制与 require.ensure 一样。有了动态加载的方案，可以减少服务端渲染 jsbundle 文件的大小，页面 Vue 组件模块也可以按需加载。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'async-swiper'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token comment">// 通过注释webpackChunkName 指定生成的chunk名称</span>
 <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;asyncSwiper&quot; */</span> <span class="token string">'./AsyncSwiper.js'</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>AsyncSwiper<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token function">resolve</span><span class="token punctuation">(</span>AsyncSwiper<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Vue dynamic component load<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token keyword">async</span><span class="token operator">-</span>swiper<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">async</span><span class="token operator">-</span>swiper<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
</code></pre></div><h3 id="_3-egg-vue-ssr-vue-component-code-spliting"><a href="#_3-egg-vue-ssr-vue-component-code-spliting" aria-hidden="true" class="header-anchor">#</a> 3. Egg + Vue SSR Vue Component Code Spliting</h3> <h4 id="_3-1-easywebpack-vue-版本要求"><a href="#_3-1-easywebpack-vue-版本要求" aria-hidden="true" class="header-anchor">#</a> 3.1 easywebpack-vue 版本要求</h4> <ul><li><p>easywebpack-vue: ^3.5.1</p></li></ul><p>构建适配 <code>vue-server-renderer</code> 异步渲染查找 <code>chunk</code> 文件逻辑。这里直接把 <code>chunk</code> 文件构建到 <code>app/view/node_modules</code> 下面, 这样异步渲染才能找到该文件。</p> <h4 id="_3-2-项目添加-egg-view-vue-ssr-插件参数配置"><a href="#_3-2-项目添加-egg-view-vue-ssr-插件参数配置" aria-hidden="true" class="header-anchor">#</a> 3.2 项目添加 egg-view-vue-ssr 插件参数配置</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> app <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

 exports<span class="token punctuation">.</span>vuessr <span class="token operator">=</span> <span class="token punctuation">{</span>
   renderOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
     <span class="token comment">// 告诉 vue-server-renderer 去 app/view 查找异步 chunk 文件</span>
     basedir<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>baseDir<span class="token punctuation">,</span> <span class="token string">'app/view'</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>

 <span class="token keyword">return</span> exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div><p><a href="https://github.com/hubcarl/egg-vue-webpack-boilerplate/blob/master/config/config.default.js" target="_blank">config/config.default.js</a></p> <h4 id="_3-3-动态加载举例"><a href="#_3-3-动态加载举例" aria-hidden="true" class="header-anchor">#</a> 3.3 动态加载举例</h4> <p><a href="https://github.com/easy-team/egg-vue-webpack-boilerplate/blob/webpack3/app/web/page/dynamic/dynamic.vue" target="_blank">app/web/page/dynamic/dynamic.vue</a></p> <h4 id="_3-4-referenceerror-document-is-not-defined"><a href="#_3-4-referenceerror-document-is-not-defined" aria-hidden="true" class="header-anchor">#</a> 3.4 ReferenceError: document is not defined</h4> <p><a href="https://zhuanlan.zhihu.com/p/36233639" target="_blank">ReferenceError: document/window is not defined</a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/seo.html" class="prev">
          SEO实现
        </a></span> <span class="next"><a href="/typescript.html">
          TypeScript
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ad616d9c.js" defer></script><script src="/assets/js/2.67c62971.js" defer></script><script src="/assets/js/14.c3af845f.js" defer></script>
  </body>
</html>
