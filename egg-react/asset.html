<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>背景 | easy-team</title>
    <meta name="description" content="easy-team">
    
    
    <link rel="preload" href="/egg-react/assets/css/0.styles.5071020a.css" as="style"><link rel="preload" href="/egg-react/assets/js/app.05c41d07.js" as="script"><link rel="preload" href="/egg-react/assets/js/2.396ed812.js" as="script"><link rel="preload" href="/egg-react/assets/js/9.cb451d18.js" as="script"><link rel="prefetch" href="/egg-react/assets/js/10.5bae45bd.js"><link rel="prefetch" href="/egg-react/assets/js/11.ba980359.js"><link rel="prefetch" href="/egg-react/assets/js/12.c4425160.js"><link rel="prefetch" href="/egg-react/assets/js/13.72428423.js"><link rel="prefetch" href="/egg-react/assets/js/14.a96d777d.js"><link rel="prefetch" href="/egg-react/assets/js/15.e69a7728.js"><link rel="prefetch" href="/egg-react/assets/js/16.27009042.js"><link rel="prefetch" href="/egg-react/assets/js/17.81d1b2d1.js"><link rel="prefetch" href="/egg-react/assets/js/18.a8731c81.js"><link rel="prefetch" href="/egg-react/assets/js/19.845d5623.js"><link rel="prefetch" href="/egg-react/assets/js/20.c4e23bb3.js"><link rel="prefetch" href="/egg-react/assets/js/21.62f4b05f.js"><link rel="prefetch" href="/egg-react/assets/js/22.9b5afc12.js"><link rel="prefetch" href="/egg-react/assets/js/23.45a6feff.js"><link rel="prefetch" href="/egg-react/assets/js/24.7e1677b9.js"><link rel="prefetch" href="/egg-react/assets/js/25.b07ef8b3.js"><link rel="prefetch" href="/egg-react/assets/js/26.a7670150.js"><link rel="prefetch" href="/egg-react/assets/js/3.8510c06d.js"><link rel="prefetch" href="/egg-react/assets/js/4.1018a166.js"><link rel="prefetch" href="/egg-react/assets/js/5.7d3b7cff.js"><link rel="prefetch" href="/egg-react/assets/js/6.510b20f3.js"><link rel="prefetch" href="/egg-react/assets/js/7.0f5db025.js"><link rel="prefetch" href="/egg-react/assets/js/8.5e726c6c.js">
    <link rel="stylesheet" href="/egg-react/assets/css/0.styles.5071020a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/egg-react/" class="home-link router-link-active"><!----> <span class="site-name">easy-team</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/egg-react/easywebpack.html" class="nav-link">easywebpack</a></div><div class="nav-item"><a href="/egg-react/egg-vue.html" class="nav-link">egg + vue</a></div><div class="nav-item"><a href="/egg-react/egg-react.html" class="nav-link">egg + react</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/egg-react/easywebpack.html" class="nav-link">easywebpack</a></div><div class="nav-item"><a href="/egg-react/egg-vue.html" class="nav-link">egg + vue</a></div><div class="nav-item"><a href="/egg-react/egg-react.html" class="nav-link">egg + react</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/egg-react/init.html" class="sidebar-link">快速开始</a></li><li><a href="/egg-react/start.html" class="sidebar-link">从零开始</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/egg-react/render.html" class="sidebar-heading clickable open"><span>渲染模式</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/egg-react/node.html" class="sidebar-link">服务端渲染模式</a></li><li><a href="/egg-react/web.html" class="sidebar-link">前端渲染模式</a></li><li><a href="/egg-react/asset.html" class="active sidebar-link">asset 前端渲染</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/egg-react/asset.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/egg-react/asset.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/egg-react/asset.html#骨架项目" class="sidebar-link">骨架项目</a></li><li class="sidebar-sub-header"><a href="/egg-react/asset.html#参考实现" class="sidebar-link">参考实现</a></li></ul></li><li><a href="/egg-react/html.html" class="sidebar-link">HTML前端渲染</a></li></ul></section></li><li><a href="/egg-react/config.html" class="sidebar-link">配置说明</a></li><li><a href="/egg-react/build.html" class="sidebar-link">构建流程</a></li><li><a href="/egg-react/online.html" class="sidebar-link">部署流程</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>特性介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/egg-react/seo.html" class="sidebar-link">SEO 实现</a></li><li><a href="/egg-react/babel.html" class="sidebar-link">Babel 配置</a></li><li><a href="/egg-react/antd.html" class="sidebar-link">AntD 配置</a></li><li><a href="/egg-react/https:/www.yuque.com/hubcarl/easywebpack/cssmodule.html" class="sidebar-link">Css Module</a></li><li><a href="/egg-react/async.html" class="sidebar-link">组件异步加载</a></li><li><a href="/egg-react/typescript.html" class="sidebar-link">TypeScript</a></li></ul></section></li><li><a href="/egg-react/version.html" class="sidebar-link">插件版本</a></li><li><a href="/egg-react/update.html" class="sidebar-link">升级更新</a></li><li><section class="sidebar-group depth-0"><a href="/egg-react/about.html" class="sidebar-heading clickable"><span>常见问题</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/egg-react/demo.html" class="sidebar-link">社区作品</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p style="padding-left:2em;">在 <a href="https://www.yuque.com/easy-team/egg-react/web" target="_blank">前端渲染模式</a> 章节讲到了基于 React 的一体化的前端渲染模式，好处是不需要借助第三方模板引擎且无效关注静态资源注入问题，但有两个小的功能限制：</p><ul><li><p>layout 模板数据绑定能力较弱</p></li></ul><ul><li><p>资源注入不能自己定义，比如 async， crossorigin 等配置</p></li></ul><p style="padding-left:2em;">针对上面问题<a href="https://github.com/easy-team/egg-view-react-ssr" target="_blank"> egg-view-react-ssr </a>(&gt;=2.4.0)扩展 <a href="https://github.com/easy-team/egg-view-react-ssr/blob/master/app/extend/context.js#L9" target="_blank">renderAsset</a> 方法支持基于 asset 的<strong>前端渲染模式</strong>，方便对 layout 进行定制和数据绑定。</p><p style="padding-left:2em;"><br></p> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <ul><li><p>renderAsset 模式默认使用 <span style="color:#2F54EB;">egg-view-nunjucks</span> 模板引擎对 layout 进行数据模板编译，你需要在项目 package.json 中同时安装 <a href="https://github.com/easy-team/egg-view-react-ssr" target="_blank">egg-view-react-ssr</a> 和 <a href="https://github.com/eggjs/egg-view-nunjucks" target="_blank">egg-view-nunjucks</a> 插件依赖。</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ${root}/package.json</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;dependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;egg-view-nunjucks&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;egg-view-react-ssr&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.4.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><ul><li><p>开启 <a href="https://github.com/eggjs/egg-view-nunjucks" target="_blank">egg-view-nunjucks</a> 插件配置</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ${root}/config/plugin.json</span>
exports<span class="token punctuation">.</span>reactssr <span class="token operator">=</span> <span class="token punctuation">{</span>
 enable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
 <span class="token keyword">package</span><span class="token punctuation">:</span> <span class="token string">'egg-view-react-ssr'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>nunjucks <span class="token operator">=</span> <span class="token punctuation">{</span>
 enable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
 <span class="token keyword">package</span><span class="token punctuation">:</span> <span class="token string">'egg-view-nunjucks'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div><ul><li><p>配置 layout.html  模板</p></li></ul><blockquote><p>模板默认路径：${root}/app/view/layout.html<span style="color:#24292E;"><span style="background-color:#FFFFFF;">， 你可以通过</span></span><a href="https://github.com/easy-team/egg-view-react-ssr" target="_blank"> egg-view-react-ssr</a> 的 layout 属性配置指定模板位置。</p></blockquote><p><strong>渲染上下文暴露全局 asset 对象，参数如下：</strong></p><p style="padding-left:2em;"><strong>asset.js</strong> { Array } 页面依赖的静态 JS 资源 URL 列表， 来自 <code>config/manifest.json</code> 具体见 <a href="https://www.yuque.com/easy-team/easywebpack/deps" target="_blank">资源依赖</a></p><p style="padding-left:2em;"><strong>asset.css</strong> { Array } 页面依赖的静态 JS 资源 URL 列表，来自<code>config/manifest.json</code>具体见 <a href="https://www.yuque.com/easy-team/easywebpack/deps" target="_blank">资源依赖</a></p><p style="padding-left:2em;"><strong>asset.state</strong> { Object } 页面渲染原始数据，用于 MV 框架初始化 state</p><p>以下就是基于 nunjucks 的语法的 layout 模板配置, 你可以根据指定渲染引擎编写 layout 文件。</p> <div class="language-html extra-class"><pre class="language-html"><code>


 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>keywords<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>description<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content-type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/html;charset=utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>shortcut icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/favicon.ico<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/x-icon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 {% for item in asset.css %}
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 {% endfor %}


 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
   window<span class="token punctuation">.</span>__INITIAL_STATE__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> asset<span class="token punctuation">.</span>state <span class="token operator">|</span> safe <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 {% for item in asset.js %}
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
 {% endfor %}


</code></pre></div><ul><li><p>renderAsset  默认调用，使用 nunjucks 模板引擎</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> egg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">AppController</span> <span class="token keyword">extends</span> <span class="token class-name">egg<span class="token punctuation">.</span>Controller</span> <span class="token punctuation">{</span>
 <span class="token keyword">async</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderAsset</span><span class="token punctuation">(</span><span class="token string">'app.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'egg-react-asset'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><ul><li><p>renderAsset 自定义模板引擎（支持两种方式, 注意要安装指定模板引擎)</p></li></ul><blockquote><ol start="1"><li><p> 可以通过 <a href="https://github.com/easy-team/egg-view-react-ssr" target="_blank">egg-view-react-ssr</a> 的 viewEngine  配置全局渲染引擎</p></li></ol><ol start="2"><li><p> 通过 renderAsset 的第三个参数 viewEngine 配置对应渲染引擎，只在当前渲染生效</p></li></ol><p></p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> egg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">AdminController</span> <span class="token keyword">extends</span> <span class="token class-name">egg<span class="token punctuation">.</span>Controller</span> <span class="token punctuation">{</span>
 <span class="token keyword">async</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 使用 ejs 引擎，注意项目请安装 https://github.com/eggjs/egg-view-ejs 依赖</span>
   <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderAsset</span><span class="token punctuation">(</span><span class="token string">'admin.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">'egg-react-asset'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> viewEngine<span class="token punctuation">:</span> <span class="token string">'ejs'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre></div><h2 id="骨架项目"><a href="#骨架项目" class="header-anchor">#</a> 骨架项目</h2> <p style="padding-left:2em;"><a href="https://github.com/easy-team/egg-react-webpack-boilerplate/tree/feature/green/asset" target="_blank">https://github.com/easy-team/egg-react-webpack-boilerplate/tree/feature/green/asset</a></p> <h2 id="参考实现"><a href="#参考实现" class="header-anchor">#</a> 参考实现</h2> <p style="padding-left:2em;"><a href="https://github.com/eggjs/egg-view-assets" target="_blank">https://github.com/eggjs/egg-view-assets</a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/egg-react/web.html" class="prev">前端渲染模式</a></span> <span class="next"><a href="/egg-react/html.html">HTML前端渲染</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/egg-react/assets/js/app.05c41d07.js" defer></script><script src="/egg-react/assets/js/2.396ed812.js" defer></script><script src="/egg-react/assets/js/9.cb451d18.js" defer></script>
  </body>
</html>
